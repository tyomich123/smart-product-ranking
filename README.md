# Smart Product Ranking for WooCommerce

## Опис

Плагін для інтелектуального ранжування продуктів WooCommerce на основі релевантності категорії та поведінкових факторів користувачів.

## Можливості

### Основні функції:

1. **Інтелектуальне ранжування на основі релевантності**
   - Назва продукту (найбільший вплив)
   - Опис продукту (середній вплив)
   - Кількість продажів
   - Кількість відгуків
   - Кількість переглядів

2. **Семантичне порівняння**
   - Пошук часткових співпадінь слів
   - Підтримка української та англійської мов
   - Алгоритм Левенштейна для визначення схожості
   - Робота з морфологічними формами слів

3. **Відстеження поведінки користувачів**
   - Автоматичне відстеження переглядів продуктів
   - Відстеження покупок
   - Підтримка анонімних користувачів
   - Захист від дублювання (один перегляд раз на 30 хвилин)

4. **Оптимізація продуктивності**
   - Кешування результатів
   - Асинхронне оновлення скорів
   - Оптимізовані SQL запити з JOIN

## Вимоги

- WordPress 6.0 або вище
- WooCommerce 8.0 або вище (тестовано до 10.3.7)
- PHP 7.4 або вище
- MySQL 5.6 або вище

## Встановлення

1. Завантажте всю папку плагіна до `/wp-content/plugins/smart-product-ranking/`
2. Активуйте плагін через меню "Плагіни" в WordPress
3. Перейдіть до "Product Ranking" > "Налаштування" для конфігурації
4. Натисніть "Перерахувати релевантність для всіх продуктів" для початкової індексації

## Структура файлів

```
smart-product-ranking/
├── smart-product-ranking.php          # Головний файл плагіна
├── includes/
│   ├── class-spr-tracker.php          # Відстеження поведінки користувачів
│   ├── class-spr-ranking-engine.php   # Обчислення релевантності
│   ├── class-spr-query-modifier.php   # Модифікація WooCommerce запитів
│   ├── class-spr-admin.php            # Адміністративна панель
│   └── class-spr-semantic-matcher.php # Семантичне порівняння
├── assets/
│   ├── js/
│   │   └── admin.js                   # JavaScript для адмінки
│   └── css/
└── README.md                          # Документація
```

## Налаштування

### Вагові коефіцієнти

У розділі "Product Ranking" > "Налаштування" ви можете налаштувати вагу кожного фактора:

- **Вага назви продукту** (за замовчуванням: 10) - Найбільший вплив на ранжування
- **Вага опису продукту** (за замовчуванням: 5) - Середній вплив
- **Вага продажів** (за замовчуванням: 3) - Товари що частіше купують
- **Вага відгуків** (за замовчуванням: 2) - Товари з відгуками
- **Вага переглядів** (за замовчуванням: 1) - Товари що частіше переглядають

### Додаткові параметри

- **Семантичне порівняння** - Включення/вимкнення семантичного порівняння текстів
- **Відстеження анонімних користувачів** - Відстеження переглядів користувачів без авторизації
- **Тривалість кешу** - Час зберігання кешованих результатів (в секундах)

## Використання

### Автоматичне сортування

Після активації плагіна, продукти в категоріях автоматично сортуються за релевантністю. 

У фронтенді буде доступна опція сортування "За релевантністю" в dropdown меню WooCommerce.

### Ручне отримання скору релевантності

Використовуйте функцію в PHP коді теми:

```php
$relevance_score = spr_get_product_relevance($product_id);
echo "Релевантність: " . $relevance_score . "%";
```

### Шорткод

Додайте скор релевантності в будь-яке місце:

```
[product_relevance show_label="yes"]
```

## Принцип роботи

### Алгоритм ранжування

Плагін працює за принципом Google Search:

1. **Аналіз назви продукту** - перевірка чи містить назва ключові слова з назви категорії
2. **Аналіз опису** - перевірка опису на наявність релевантних слів
3. **Семантичний аналіз** - порівняння тексту з урахуванням схожості слів
4. **Поведінкові фактори**:
   - Кількість продажів (логарифмічна шкала)
   - Кількість відгуків (логарифмічна шкала)
   - Кількість переглядів за останні 30 днів

### Формула релевантності

```
Скор = (TitleScore × TitleWeight) + 
       (DescScore × DescWeight) + 
       (SalesScore × SalesWeight) + 
       (ReviewsScore × ReviewsWeight) + 
       (ViewsScore × ViewsWeight)
```

Результат нормалізується до шкали 0-100%.

### Семантичне порівняння

Плагін використовує комбінацію методів:

1. **Точне співпадіння** - пошук точних збігів слів
2. **Часткове співпадіння** - пошук підрядків
3. **Відстань Левенштейна** - порівняння схожості слів з урахуванням помилок

## База даних

Плагін створює дві таблиці:

### wp_spr_product_views
Зберігає інформацію про перегляди продуктів:
- product_id - ID продукту
- category_id - ID категорії
- view_date - дата/час перегляду
- user_id - ID користувача (якщо авторизований)
- session_id - ID сесії (для анонімів)

### wp_spr_product_relevance
Кешує обчислені скори релевантності:
- product_id - ID продукту
- category_id - ID категорії
- relevance_score - скор релевантності (0-100)
- last_updated - час останнього оновлення

## Статистика

У розділі "Product Ranking" > "Статистика" доступна інформація:

- Загальна кількість переглядів
- Кількість унікальних продуктів
- Кількість розрахованих скорів
- Топ-10 найбільш переглянутих продуктів (за 30 днів)
- Топ-10 продуктів з найвищою релевантністю

## Продуктивність

### Оптимізація

- Використання кешу WordPress для скорів релевантності
- Асинхронне оновлення скорів через WP Cron
- Оптимізовані SQL запити з індексами
- Автоматичне очищення старих записів (видалення переглядів старше 90 днів)

### Рекомендації

- Запускайте перерахунок релевантності в години низького навантаження
- Налаштуйте тривалість кешу відповідно до частоти оновлення продуктів
- Для великих магазинів (>10000 продуктів) розгляньте використання більш потужного хостингу

## Cron задачі

Плагін використовує наступні cron задачі:

- `spr_update_relevance` - оновлення релевантності конкретного продукту (одноразова, через 5 хвилин після дії)
- `spr_cleanup_views` - щоденне очищення старих переглядів

## Hooks і фільтри

### Доступні хуки:

```php
// Перед відстеженням перегляду
do_action('spr_before_track_view', $product_id, $category_id);

// Після відстеження перегляду
do_action('spr_after_track_view', $product_id, $category_id);

// Фільтр для зміни скору релевантності
$score = apply_filters('spr_relevance_score', $score, $product_id, $category_id);
```

## FAQ

**Q: Чому скор релевантності не оновлюється відразу?**  
A: Скори оновлюються асинхронно через 5 хвилин після дії (перегляд, покупка) для економії ресурсів сервера.

**Q: Чи підтримується мультимовність?**  
A: Так, плагін підтримує українську та англійську мови для семантичного аналізу.

**Q: Як часто потрібно перераховувати релевантність?**  
A: Автоматично після кожної покупки чи перегляду. Ручний перерахунок потрібен тільки після зміни налаштувань або імпорту нових продуктів.

**Q: Чи впливає плагін на швидкість сайту?**  
A: Мінімально. Всі обчислення кешуються, а оновлення відбуваються асинхронно. На фронтенді використовуються тільки оптимізовані SQL JOIN.

## Підтримка

Для питань та підтримки:
- Email: your-email@example.com
- GitHub: https://github.com/your-repo

## Ліцензія

GPL v2 або пізніша

## Changelog

### 1.0.0
- Початковий реліз
- Інтелектуальне ранжування продуктів
- Семантичне порівняння текстів
- Відстеження поведінки користувачів
- Адміністративна панель зі статистикою
